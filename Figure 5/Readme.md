Code used in Figure 5.
